name: bootstrap
description: |
  Bootstraps repository by installing node and fills/retrieves the node_modules cache if required
inputs:
  install-cmd:
    description: install command
    required: false
    default: ''
runs:
  using: composite
  steps:
    - uses: actions/setup-node@6044e13b5dc448c55e2357c09f80417699197238 # v6.2.0
      with:
        node-version-file: '.nvmrc'
    # install npm dependent on the root package engines entry for npm
    # we always expect that entry to be there and syncs and is synced by with renovate
    - shell: bash
      run: |
        npm install -g npm@$(cat ${{ github.workspace }}/package.json | jq -r '.engines.npm' )
        npm -v
    - uses: actions/cache@8b402f58fbc84540c8b491a91e594a4576fec3d7 # v5.0.2
      id: cache
      with:
        path: |
          **/node_modules
          /home/runner/.cache/Cypress
        # if you ever want to ignore or rebuild the cache you can temporarily
        # remove the restore-keys related comments here also see
        # https://github.com/actions/cache/blob/main/tips-and-workarounds.md#update-a-cache
        key: ${{ runner.os }}-bootstrap-cache-${{ hashFiles('**/package-lock.json') }} #-${{ github.run_id }}
        # restore-keys: |
        #   ${{ runner.os }}-bootstrap-cache-${{ hashFiles('**/package-lock.json') }}

      # actions/cache runs a post run step on successful job completion to save
      # the contents of node_modules so the result of this command (if run)
      # will be saved to the cache.
    - if: steps.cache.outputs.cache-hit != 'true' && inputs.install-cmd != ''
      shell: bash
      run: ${{ inputs.install-cmd }}

