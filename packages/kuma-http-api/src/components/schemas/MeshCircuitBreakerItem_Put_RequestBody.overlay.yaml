overlay: 1.0.0
info:
  title: Customise MeshCircuitBreaker
  version: 0.1.0
extends: ../../../generated/components/schemas/MeshCircuitBreakerItem.yaml
actions:
  # mark as a request body so we can make amends for request bodies
  - target: '$'
    update:
      x-request: true

  # default specs.default just for this policy
  - target: '$.properties.spec.properties.to.items'
    update:
      default:
        targetRef:
          kind: MeshService
        default:
          connectionLimits:
            maxConnections: 2
            maxPendingRequests: 8
            maxRetries: 2
            maxRequests: 2
  - target: '$.properties.spec.properties.rules.items'
    update:
      default:
        targetRef:
          kind: MeshService
        default:
          connectionLimits:
            maxConnections: 2
            maxPendingRequests: 8
            maxRetries: 2
            maxRequests: 2
  - target: '$.properties.spec.properties.to.items.properties.default'
    update:
      default:
        connectionLimits:
          maxConnections: 2
          maxPendingRequests: 8
          maxRetries: 2
          maxRequests: 2
