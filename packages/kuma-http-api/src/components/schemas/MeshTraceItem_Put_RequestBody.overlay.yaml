overlay: 1.0.0
info:
  title: Customise MeshTrace
  version: 0.1.0
extends: ../../../generated/components/schemas/MeshTraceItem.yaml
actions:
  # mark as a request body so we can make amends for request bodies
  - target: '$'
    update:
      x-request: true

  # default specs.default just for this policy
  - target: '$.properties.spec'
    update:
      default:
        default:
          backends: []

  # backends.type should be oneOf
  - target: '$..backends.items.properties.zipkin'
    remove: true
  - target: '$..backends.items.properties.datadog'
    remove: true
  - target: '$..backends.items.properties.openTelemetry'
    remove: true

  - target: '$..backends.items'
    update:
      default:
        type: Zipkin
        zipkin:
          url: ''
      oneOf:
        - type: object
          default:
            type: Zipkin
            zipkin:
              url: ''
          properties:
            type: { const: Zipkin }
            zipkin:
              $ref: !!oas-overlay/dereference '../../../generated/components/schemas/MeshTraceItem.yaml#/properties/spec/properties/default/properties/backends/items/properties/zipkin'
        - type: object
          default:
            type: Datadog
            datadog:
              url: ''
          properties:
            type: { const: Datadog }
            datadog:
              $ref: !!oas-overlay/dereference '../../../generated/components/schemas/MeshTraceItem.yaml#/properties/spec/properties/default/properties/backends/items/properties/datadog'
        - type: object
          default:
            type: OpenTelemetry
            openTelemetry:
              endpoint: ''
          properties:
            type: { const: OpenTelemetry }
            openTelemetry:
              $ref: !!oas-overlay/dereference '../../../generated/components/schemas/MeshTraceItem.yaml#/properties/spec/properties/default/properties/backends/items/properties/openTelemetry'
