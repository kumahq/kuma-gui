overlay: 1.0.0
info:
  title: Customise MeshHealthCheck
  version: 0.1.0
extends: ../../../generated/components/schemas/MeshHealthCheckItem.yaml
actions:
  # mark as a request body so we can make amends for request bodies
  - target: '$'
    update:
      x-request: true

  # default specs.default just for this policy
  - target: '$.properties.spec.properties.to.items'
    update:
      default:
        targetRef:
          kind: MeshService
        default:
          interval: 10s
          timeout: 2s
          unhealthyThreshold: 3
          healthyThreshold: 1
          http:
            path: "/health"
            expectedStatuses:
            - 200
  - target: '$.properties.spec.properties.rules.items'
    update:
      default:
        targetRef:
          kind: MeshService
        default:
          interval: 10s
          timeout: 2s
          unhealthyThreshold: 3
          healthyThreshold: 1
          http:
            path: "/health"
            expectedStatuses:
            - 200
