overlay: 1.0.0
info:
  title: Customise MeshRetry
  version: 0.1.0
extends: ../../../generated/components/schemas/MeshRetryItem.yaml
actions:
  # mark as a request body so we can make amends for request bodies
  - target: '$'
    update:
      x-request: true

  # default specs.default just for this policy
  - target: '$.properties.spec.properties.to.items'
    update:
      default:
        targetRef:
          kind: MeshService
        default:
          http:
            numRetries: 10
            backOff:
              baseInterval: 15s
              maxInterval: 20m
            retryOn:
            - 5xx
  - target: '$.properties.spec.properties.rules.items'
    update:
      default:
        targetRef:
          kind: MeshService
        default:
          http:
            numRetries: 10
            backOff:
              baseInterval: 15s
              maxInterval: 20m
            retryOn:
            - 5xx
